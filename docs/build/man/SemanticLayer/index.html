<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Semantic Layer · Game Tuner Documentation</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="./man/SemanticLayer/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Game Tuner Documentation</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">BI Tool</span><ul><li><a class="tocitem" href="../Dashboards/">Dashboards</a></li><li><a class="tocitem" href="../Stories/">Stories</a></li><li><a class="tocitem" href="../Hub/">Hub</a></li><li><a class="tocitem" href="../Annotations/">Annotations</a></li></ul></li><li><span class="tocitem">Telemetry</span><ul><li><a class="tocitem" href="../SDK/">SDK</a></li><li><a class="tocitem" href="../StandardEvents/">Standard Events</a></li><li><a class="tocitem" href="../Eventory/">Eventory</a></li></ul></li><li><span class="tocitem">Data Platform</span><ul><li><a class="tocitem" href="../UserEntity/">User Entity</a></li><li><a class="tocitem" href="../IntegratedSources/">Integrated Data Sources</a></li><li><a class="tocitem" href="../DDA/">DDA (Direct Data Access)</a></li></ul></li><li class="is-active"><a class="tocitem" href>Semantic Layer</a><ul class="internal"><li><a class="tocitem" href="#Getting-Started"><span>Getting Started</span></a></li><li><a class="tocitem" href="#Datasources"><span>Datasources</span></a></li><li><a class="tocitem" href="#Problems"><span>Problems</span></a></li><li><a class="tocitem" href="#Registrations-or-the-number-of-installs"><span><code>Registrations</code> or the number of installs</span></a></li><li><a class="tocitem" href="#DAU-totals-and-irregular-dimensions"><span><code>DAU</code> totals and irregular dimensions</span></a></li><li><a class="tocitem" href="#Conclusions"><span>Conclusions</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Semantic Layer</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Semantic Layer</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h2 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h2><p>Semantic Layer is pre-set for every new Game Tuner project. This documentation will provide an introduction about the inner workings of GT Semantic Layer and continue into how you can expand the entities defined by the Semantic Layer.</p><h2 id="Datasources"><a class="docs-heading-anchor" href="#Datasources">Datasources</a><a id="Datasources-1"></a><a class="docs-heading-anchor-permalink" href="#Datasources" title="Permalink"></a></h2><p>Basic entity is a <code>Datasource</code>. Some are built-in, some are provided by out-of-the-box integrations with external data sources and you can set up your custom datasources, as well.</p><p>For most user-facing applications, including mobile games, the most important analytics is about user-level KPIs. For this purpose Game Tuner defines a Datasource called <code>User Entity</code>.</p><h3 id="User-Entity"><a class="docs-heading-anchor" href="#User-Entity">User Entity</a><a id="User-Entity-1"></a><a class="docs-heading-anchor-permalink" href="#User-Entity" title="Permalink"></a></h3><p>This is the primary datasource which is &quot;special&quot; in many ways. Semantic Layer is closely coupled with <a href="../DataModel/">Data Model</a> and Query Engine. User Entity has more built in options than any other Datasource.</p><p>The centerpiece of the User Entity is the table that tracks various <code>User Properties</code> for each user for each day. This is accompanied by all the user-generated events.</p><p>Tables:</p><ul><li><code>user_history</code> - full one row: one days for one user table tracking all the changes to user properties</li><li><code>daily_user_history</code> - one row: one day for one user, but only if a user is active on that day</li><li>trimmed tables: can have reduced values along one dimension</li></ul><pre><code class="nohighlight hljs">+ example: a user_history like table that has cohort_day values only for specific days; used only when filter is used on that dimension that match givven values</code></pre><ul><li><code>registration_user_history</code> - holds only values for cohort_day = 0</li><li><code>snapshot_user_history</code> - optimization technique for storage; could remove the need for full <code>user_history</code> and be used for rewinding and calculating totals on-the-fly</li></ul><pre><code class="nohighlight hljs">+ Example: let us store only UH partitions for even dates. Using that, registration_user_history and daily_user_history, you can recontruct UH for odd dates, on-the-fly, or easily materialize it</code></pre><h4 id="User-Properties"><a class="docs-heading-anchor" href="#User-Properties">User Properties</a><a id="User-Properties-1"></a><a class="docs-heading-anchor-permalink" href="#User-Properties" title="Permalink"></a></h4><p>Defining user properties...</p><p><em>TODO</em> ... ... ...</p><h3 id="Other-Sources"><a class="docs-heading-anchor" href="#Other-Sources">Other Sources</a><a id="Other-Sources-1"></a><a class="docs-heading-anchor-permalink" href="#Other-Sources" title="Permalink"></a></h3><p><em>TODO</em> ... ... ...</p><h2 id="Problems"><a class="docs-heading-anchor" href="#Problems">Problems</a><a id="Problems-1"></a><a class="docs-heading-anchor-permalink" href="#Problems" title="Permalink"></a></h2><h2 id="Registrations-or-the-number-of-installs"><a class="docs-heading-anchor" href="#Registrations-or-the-number-of-installs"><code>Registrations</code> or the number of installs</a><a id="Registrations-or-the-number-of-installs-1"></a><a class="docs-heading-anchor-permalink" href="#Registrations-or-the-number-of-installs" title="Permalink"></a></h2><h4 id="We-can-calculate-this-easiely-with-the-User-History-data-structure.-The-formula-is-simply:"><a class="docs-heading-anchor" href="#We-can-calculate-this-easiely-with-the-User-History-data-structure.-The-formula-is-simply:">We can calculate this easiely with the <code>User History</code> data structure. The formula is simply:</a><a id="We-can-calculate-this-easiely-with-the-User-History-data-structure.-The-formula-is-simply:-1"></a><a class="docs-heading-anchor-permalink" href="#We-can-calculate-this-easiely-with-the-User-History-data-structure.-The-formula-is-simply:" title="Permalink"></a></h4><pre><code class="language-sql hljs">select
	date_,
	sum(dau) as registrations
	-- or sum(cohort_size) as registrations
	-- there can be some small difference
from main.user_history
where cohort_day = 0
group by 1</code></pre><p>or in our config:</p><pre><code class="language-yaml hljs">registrations:
  label: Registrations
  x:
      select_statement: SUM({dau})
      where: cohort_day = 0
  kpi: x
  total: sum(x)</code></pre><p>But the problem with this definition is that it works only for daily metrics. In a cohort view, we need to have different approach. There are several things we can do:</p><p>We can have different definition for <code>Registration</code> as a cohort metric. We can do:</p><pre><code class="language-sql hljs">select
	cohort_day,
	sum(cohort_size) as registrations
from main.user_history
group by 1</code></pre><p>or in yaml config format:</p><pre><code class="language-yaml hljs">registrations: # cohorted
  label: Registrations
  x:
      select_statement: SUM({cohort_size})
  kpi: x
  total: sum(x)</code></pre><p>Which is vastly different and can&#39;t work interchangeably. Another problem is that this way of computing &quot;registrations over cohort day&quot; is insane waste of resources. Basically, we&#39;d need to use full User History table, always, for something that clearly can be computed much easier if we only allow it.</p><h4 id="We-can-use-simple-heuristics"><a class="docs-heading-anchor" href="#We-can-use-simple-heuristics">We can use simple heuristics</a><a id="We-can-use-simple-heuristics-1"></a><a class="docs-heading-anchor-permalink" href="#We-can-use-simple-heuristics" title="Permalink"></a></h4><p>Heuristic is, and this is a bit silly to write, <code>Registration(cohort_day = N)</code> = <code>Registration(cohort_day = 0</code>. Using this we can do couple of things. We can either hard-code this heuristic for <code>Registrations</code> and other similar KPIs (and theres very few of them, one is <code>UA Spend</code>) or we can explilicitly define a function that does something like it, eg. <code>f(x) = expand_in_cohort_time(x) = f(0)</code>. It will require more complex behavior for bundling multiple cohorts, but something along those lines.</p><ul><li><p>If we hard code this, then we can leave config as is.</p></li><li><p>If we want to explicitly define this behavior, then we need to redefine how we write config.</p></li></ul><p>Now, if we have different config for daily and cohort metrics, then we can all sorts of other things. We can use it to define what&#39;s shown in the highlight numbers, or anything else that could be specific for those sort of KPIs.</p><h5 id="Further-optimization"><a class="docs-heading-anchor" href="#Further-optimization">Further optimization</a><a id="Further-optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Further-optimization" title="Permalink"></a></h5><p>Now, if we are doing any of this, there&#39;s a simple optimization for <code>Registrations</code> metric, which is often one of the most used ones, as it&#39;s used in <code>Retention</code>, <code>LTV</code> and similar cohort KPIs. Let&#39;s say we have a clean structure that corresponds to a query:</p><pre><code class="language-sql hljs">select
	*
from main.user_history
where cohort_day = 0</code></pre><p>and let it exist in <code>main.registration</code> table. This structure will have identical values for <code>date_</code> and <code>registration_date</code>. A querry run agains this structure will yeald the same result as the first formula, but will be computationally much less expensive. Next step is either one of implicit expanding of the KPI defined only for d0 to other cohort days, or the one where we do it explicitly, as defined in the config.</p><h2 id="DAU-totals-and-irregular-dimensions"><a class="docs-heading-anchor" href="#DAU-totals-and-irregular-dimensions"><code>DAU</code> totals and irregular dimensions</a><a id="DAU-totals-and-irregular-dimensions-1"></a><a class="docs-heading-anchor-permalink" href="#DAU-totals-and-irregular-dimensions" title="Permalink"></a></h2><p>Let&#39;s start with a structure that has <em>regular</em> dimensions, which means that if we break up <code>DAU</code>, for instance, by any of dimensions and then sum it up, we&#39;ll get the same result. Now there&#39;s still the question of how <code>DAU</code> should behave when we set time grain to something other than a <code>day</code>, eg. <code>week</code>. The question is: <em>What is weekly <code>DAU</code>?</em> One could say this is not defined, but implicitly, it&#39;s not something we intuitivelly believe. It makes sense to say that weekly <code>DAU</code> is an average of daily <code>DAU</code> KPI. That would make <code>date</code> dimension irregular in respect to <code>DAU</code>, but weekly <code>Revenue</code> is still <em>sum</em> of daily <code>Revenue</code>, which makes <code>date</code> a proper dimension in respect to <code>Revenue</code> KPI.</p><p>To make things more complicated, let&#39;s look at <code>ARPDAU</code>, which is calculated by the formula: <code>SUM(Revenue) / SUM(DAU)</code>.</p><p>Weekly <code>ARPDAU</code> is still calculated as <code>SUM(Revenue) / SUM(DAU)</code>, which makes <code>date</code> a proper dimension for <code>DAU</code> in this context.</p><p>There&#39;s a few options here:</p><ul><li>either we dismiss the notion that weekly <code>DAU</code> is an average, and continue using the sum for it, as well, albeit it creates non-intuitive metric</li><li>or we need to accomodate this special behavior at the KPI level, while clearly distinguishing <code>DAU</code> as a KPI and <code>dau</code> as a building block for other metrics.</li></ul><h3 id="Irregular-dimensions"><a class="docs-heading-anchor" href="#Irregular-dimensions">Irregular dimensions</a><a id="Irregular-dimensions-1"></a><a class="docs-heading-anchor-permalink" href="#Irregular-dimensions" title="Permalink"></a></h3><p>We can expand the notion of irregular dimensions to, eg. <code>platform</code>. Unlike <code>registration_platform</code>, which is fixed by the act of the first log in, platform can be different for every sesion. SUM(<code>DAU</code>(<code>platform</code>)) &gt; <code>DAU</code>, which makes it irregular dimension in respect to <code>DAU</code> and requres special handling, if we want to allow it. This could, potentially, be solved by going one step deeper on granularity level and creating something like <code>Level User History</code>, aka some sort of User Journey data source, which would allow easier, and correct, computation of metrics at this level. Or we can define special set of rules for irregular metrics, but that can be one deep rabbit hole...</p><h2 id="Conclusions"><a class="docs-heading-anchor" href="#Conclusions">Conclusions</a><a id="Conclusions-1"></a><a class="docs-heading-anchor-permalink" href="#Conclusions" title="Permalink"></a></h2><p>Separate definition of Daily from Cohort KPIs.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../DDA/">« DDA (Direct Data Access)</a><div class="flexbox-break"></div></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
